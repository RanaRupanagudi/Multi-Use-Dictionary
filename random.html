<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Random Word</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Random Word</h1>
    <nav>
      <a href="index.html" class="active">Home</a>
      <a href="search.html">Search</a>
      <a href="categories.html">Categories</a>
      <a href="quotes.html">Idioms</a>
      <a href="random.html">Random</a>
      <a href="favorites.html">Favorites</a>
      <a href="history.html">History</a>
      <a href="settings.html">Settings</a>
    </nav>
  </header>

  <main class="text-center">
    <button id="randomBtn">üé≤ Surprise Word !</button>
    <div id="randomWordContainer" style="margin-top: 1rem;"></div>
  </main>

  <script src="script.js"></script>
  <script>
    // ‚úÖ helper function with fallback + timeout
    async function getRandomCandidate() {
      const fallbackWords = ["apple", "river", "music", "light", "friend"]; // safe words
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), 3000); // ‚è± 3s timeout

      try {
        const randomRes = await fetch(
          "https://random-word-api.herokuapp.com/word?number=1",
          { signal: controller.signal }
        );
        clearTimeout(timeout);
        if (!randomRes.ok) throw new Error("Random Word API down");
        const randomWords = await randomRes.json();
        return randomWords[0];
      } catch (err) {
        console.warn("‚ö† Random Word API failed, using fallback:", err);
        return fallbackWords[Math.floor(Math.random() * fallbackWords.length)];
      }
    }

    document.getElementById('randomBtn').addEventListener('click', async function () {
      const container = document.getElementById('randomWordContainer');
      container.innerHTML = `<p>Loading...</p>`;

      // ‚úÖ Get today‚Äôs words from localStorage to avoid duplicates
      const todayWords = JSON.parse(localStorage.getItem("todayWords") || "[]").map(w => w.word);

      let word = null;
      for (let i = 0; i < 5; i++) { // try up to 5 times
        try {
          const candidate = await getRandomCandidate(); // ‚úÖ now actually called
          if (!todayWords.includes(candidate)) {
            word = candidate;
            break;
          }
        } catch (err) {
          console.error("Error fetching random word:", err);
        }
      }

      if (!word) {
        container.innerHTML = `<p>‚ö† Could not find a unique random word. Try again.</p>`;
        return;
      }

      // ‚úÖ Lookup dictionary definition
      try {
        const dictRes = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
        if (!dictRes.ok) throw new Error("No dictionary entry");
        const data = await dictRes.json();
        if (!data[0] || !data[0].meanings?.length) throw new Error("Invalid word");

        const meaning = data[0].meanings[0].definitions[0].definition;
        const example = data[0].meanings[0].definitions[0].example || "No example available.";

        container.innerHTML = `
          <div class="card">
            <h2>${data[0].word}</h2>
            <p><strong>Meaning:</strong> ${meaning}</p>
            <p><strong>Example:</strong> ${example}</p>
          </div>
        `;
      } catch (err) {
        console.error("Error with dictionary lookup:", err);
        container.innerHTML = `<p>‚ö† Could not fetch a valid random word. Try again.</p>`;
      }
    });
  </script>
</body>
</html>
